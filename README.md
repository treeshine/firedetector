# FireDetector

2025-2 ì˜¤í”ˆì†ŒìŠ¤SWì˜ì´í•´ ê¸°ë§í”„ë¡œì íŠ¸

> ë‹¨ìˆœ ê°ì§€ë¥¼ ë„˜ì–´, "ì§„ì§œ í™”ì¬"ë¥¼ íŒë‹¨í•˜ëŠ” ì§€ëŠ¥í˜• íŒŒìˆ˜ê¾¼

ê¸°ì¡´ í™”ì¬ ê°ì§€ê¸°ëŠ” ì—°ê¸°ê°€ ì²œì¥ì— ë‹¿ì„ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í–ˆìŠµë‹ˆë‹¤.  
ì €í¬ ì„œë¹„ìŠ¤ëŠ” ì¹´ë©”ë¼ê°€ **'ëˆˆ'** ìœ¼ë¡œ ë¶ˆê½ƒì„ ê°ì§€í•˜ê³ , AIê°€ **'ë‡Œ'** ë¡œ ìƒí™©ì„ íŒë‹¨í•˜ì—¬ ì¦‰ì‹œ ì•Œë ¤ì¤ë‹ˆë‹¤.

## ğŸ‘¥ íŒ€ì› ë° ì—­í• 

| í•™ë²ˆ | ì´ë¦„ | ì—­í•  |
|---|---|---|
| 20215106 | ê°•ì±„ìš´ | ë°±ì—…ì„œë²„ êµ¬í˜„, í´ë¼ìš°ë“œ ë°±ì—… ì¸í”„ë¼ IaCêµ¬ì¶• |
| 20215203 | ì´ë™í˜ | Mobile APP ê°œë°œ ë° êµ¬ì¶• |
| 20225123| ê¹€ì„±í˜¸ | ëª¨ë¸ ì´ë²¤íŠ¸ ë¡œì§ ê°œë°œ, í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ |
| 20225132 | ê¹€ì¸ìš° | LLM API ê´€ë¦¬ ë° ì°¸ì—¬ |

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

**"ì§„ì§œ ë¶ˆì¸ê°€ìš”?" - YOLO + LLM ì´ì¤‘ ê²€ì¦**
ë‹¨ìˆœíˆ ë¹¨ê°„ìƒ‰ì„ ë¶ˆë¡œ ì¸ì‹í•˜ëŠ” ê¸°ì¡´ Vision AIì˜ í•œê³„ë¥¼ LLM ê²€ì¦ìœ¼ë¡œ ê·¹ë³µí–ˆìŠµë‹ˆë‹¤.
| ê¸°ì¡´ ë°©ì‹ (YOLO Only) | 2ì°¨ ê²€ì¦ (with LLM) |
| --- | --- |
| ë¹¨ê°„ ì¡°ëª…, ì´›ë¶ˆ, ìš”ë¦¬ ì¤‘ì¸ ê°€ìŠ¤ë¶ˆì„ ëª¨ë‘ 'í™”ì¬'ë¡œ ì˜¤íƒì§€ | ì´ë¯¸ì§€ì˜ ë§¥ë½(Context)ì„ íŒŒì•…í•˜ì—¬ ìœ„í—˜í•œ ìƒí™©ì¸ì§€ ì¬í™•ì¸
| "ì–´? ë¶ˆ ê°™ë‹¤! (ì‹ ë¢°ë„ 70%)" â†’ ì˜¤ê²½ë³´ ë°œìƒ | AI Agent ë¶„ì„ â†’ ì•Œë¦¼ ë³´ë¥˜ (ì•ˆì „)

## âš¡ï¸ í™”ì¬ ì´ë²¤íŠ¸ ë™ì‘ ë¡œì§
```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Start main.py  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Read Frame from â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Camera      â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
         â–¼                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚YOLO FireDetectionâ”‚â”€â”€â”€â”€ NO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
         â”‚ YES                                   â”‚
         â–¼                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚ Fire Detected?  â”‚ â”€â”€â”€â”€ NO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
         â”‚ YES                                   â”‚
         â–¼                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚ Draw Blue Box   â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
         â–¼                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ New Fire Event? â”‚â”€â”€ NO â”€â”€â–ºâ”‚  Update Frame   â”‚â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ YES (ì´ë²¤íŠ¸ ì˜¤ë¥˜ ë°©ì§€ìš© 2ì°¨ í™•ì¸)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Start Timer   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Timer Expired?  â”‚â”€â”€ NO â”€â”€â–º (ëŒ€ê¸°)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ YES
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Confirm Fire   â”‚â”€â”€â”€â–ºâ”‚Run Gemini       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚Analysis         â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚Log Gemini Resultâ”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Send to Frontendâ”‚â—„â”€â”€â”€â”‚  Socket Server  â”‚â—„â”€â”€ Encode Frame
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ Save In Server  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
![Architecture](docs/images/readme/architecture.png)

| ì£¼ìš” êµ¬ì„± ìš”ì†Œ | ì„¤ëª… |
| --- | --- |
| 1. Edge Device | ì¹´ë©”ë¼ ì˜ìƒ ìº¡ì²˜ ë° YOLO Lite í™”ì¬ íŠ¹í™” ëª¨ë¸ë¡œ 1ì°¨ ì˜ì‹¬ ìƒí™© í¬ì°© (Target: Raspberry Pi 4) |
| 02. Backend Server | FastAPI ê¸°ë°˜. LLM API(Gemini) í˜¸ì¶œí•˜ì—¬ 2ì°¨ ê²€ì¦ ìˆ˜í–‰ & ë¸”ë™ë°•ìŠ¤ ì˜ìƒ ì €ì¥ | 
| 03. User Client | Android App (FCM ì•Œë¦¼) & Web Dashboard (Streamlit ëª¨ë‹ˆí„°ë§) |
| 04. Cloudflare R2 Bucket | ë°±ì—… ë° ì˜¤íƒì‹ ê³  ë¹„ë””ì˜¤ ì €ì¥ ì•„ì¹´ì´ë¸Œ ë° Pre-signed URLì„ í†µí•œ ì„ì‹œ ì˜¤ë¸Œì íŠ¸ ê°œë°©, Egress ë¹„ìš© 0ì›ì˜ ë¹„ìš© íš¨ìœ¨ì  ë°±ì—… |

> í˜„ì¬ í”„ë¡œí† íƒ€ì…ì€ PC í™˜ê²½ì—ì„œ ê°œë°œë˜ì—ˆìœ¼ë©°, ì¶”í›„ ë¼ì¦ˆë² ë¦¬íŒŒì´ë¡œ í¬íŒ… ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ“ í´ë” êµ¬ì¡°

### Android

### Backup Server
```bash
backup-server
â”œâ”€â”€ .env                    # í™˜ê²½ ë³€ìˆ˜ (git ì¶”ì  ì œì™¸)
â”œâ”€â”€ .venv                   # ê°€ìƒ í™˜ê²½ (git ì¶”ì  ì œì™¸)
â”œâ”€â”€ serviceAccountKey.json  # FCM serviceAccount (git ì¶”ì  ì œì™¸)
â”œâ”€â”€ main.py                 # ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”œâ”€â”€ requirements.txt        # ì˜ì¡´ì„± ëª©ë¡
â””â”€â”€ src 
    â”œâ”€â”€ api                 # REST API ë° Websocket í•¸ë“¤ëŸ¬
    â”‚   â””â”€â”€ v1              # API v1
    â”œâ”€â”€ backup              # ë°±ì—… ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ ë¡œì§
    â”œâ”€â”€ core                # í”„ë¡œì íŠ¸ ì„¤ì • (config, logger ì„¤ì • ë“±)
    â”œâ”€â”€ db                  # DB ì—°ê²° ì„¤ì • (BaseModel, engine ë“±)
    â”‚   â””â”€â”€ models          # DB ëª¨ë¸ ì„¤ì •
    â”œâ”€â”€ middleware          # ë¯¸ë“¤ì›¨ì–´ 
    â”œâ”€â”€ repository          # ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ
    â”œâ”€â”€ schemas             # Pydantic ìŠ¤í‚¤ë§ˆ - ìš”ì²­ ë° ì‘ë‹µ json body ë§¤í•‘
    â””â”€â”€ services            # ì£¼ìš” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
```

### Cloud Backup
```bash
cloud-backup
â”œâ”€â”€ blackbox_bucket.tf          # ë°±ì—…ë°ì´í„° ì €ì¥ì†Œ ë²„í‚· ì •ì˜
â”œâ”€â”€ fp_bucket.tf                # ì˜¤íƒë°ì´í„° ì €ì¥ì†Œ ë²„í‚· ì •ì˜
â”œâ”€â”€ main.tf                     # Provider ì„ ì–¸ ë° API ì—°ê²° ì„¤ì •
â”œâ”€â”€ terraform.tfstate           # tfstate: í˜„ì¬ì˜ terraform ìƒíƒœ (git ì¶”ì  ì œì™¸)
â”œâ”€â”€ terraform.tfstate.backup    # tfstateì˜ ì´ì „ ìƒíƒœ (git ì¶”ì  ì œì™¸)
â”œâ”€â”€ terraform.tfvars            # ë³€ìˆ˜ ê°’ ì •ì˜
â””â”€â”€ variables.tf                # ë³€ìˆ˜ ì„ ì–¸
```

### Model

### Frontend
```bash
frontend
â”œâ”€â”€ .env                            # í™˜ê²½ ë³€ìˆ˜ (git ì¶”ì  ì œì™¸)
â”œâ”€â”€ .venv                           # ê°€ìƒ í™˜ê²½ (git ì¶”ì  ì œì™¸)
â”œâ”€â”€ app.py                          # ë©”ì¸ ì§„ì…ì 
â”œâ”€â”€ helpers.py                      # ëª¨ë¸ <-> ëŒ€ì‹œë³´ë“œ ì†Œì¼“ í†µì‹  í´ë¼ì´ì–¸íŠ¸ ë¡œì§
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ 0_ğŸ“Š_Dashboard.py           # ì£¼ìš” ëŒ€ì‹œë³´ë“œ í˜ì´ì§€
â”‚   â”œâ”€â”€ 2_ğŸ“·_Camera.py              # ì¹´ë©”ë¼ í˜ì´ì§€
â”‚   â”œâ”€â”€ 3_âš™ï¸_Settings.py            # í™˜ê²½ì„¤ì •
â”‚   â””â”€â”€ 4_ğŸ¬_BackupVideo.py         # ë°±ì—… / ì˜¤íƒ ë¹„ë””ì˜¤ ì¡°íšŒ í˜ì´ì§€
â””â”€â”€ requirements.txt                # ì˜ì¡´ì„±
```

## ğŸš€ Setup

- [Cloudflare R2 ì…‹ì—… ê°€ì´ë“œ](docs/setup-r2.md)
- [ë°±ì—… ì„œë²„ ì…‹ì—… ê°€ì´ë“œ](docs/setup-backup-server.md)
- [HeadScale ì„¸íŒ… ê°€ì´ë“œ](docs/setup-headscale.md)

## ğŸ‘¨â€âš–ï¸ License

ì´ í”„ë¡œì íŠ¸ëŠ” AGPL-3.0ë¼ì´ì„ ìŠ¤ë¥¼ ë”°ë¦…ë‹ˆë‹¤.

ì£¼ìš” ì˜ì¡´ì„±:
| ì´ë¦„ | ë¼ì´ì„ ìŠ¤ | ë¹„ê³  |
|---|---|---|
| [Streamlit](https://github.com/streamlit/streamlit/tree/develop) | Apache-2.0 License | |
| [FastAPI](https://github.com/fastapi/fastapi) | MIT License | |
| [SQLAlchemy](https://github.com/sqlalchemy/sqlalchemy) | MIT License | |
| [SQLite](https://sqlite.org/purchase/license) | Public Domain | |
| [Numpy](https://github.com/numpy/numpy) | BSD 3-Clause | |
| [Boto3(AWS SDK)](https://github.com/boto/boto3) | Apache-2.0 License | |
| [OpenCV](https://github.com/opencv/opencv) | Apache-2.0 License | |
| [YOLOv8](https://github.com/ultralytics/ultralytics) | AGPL-3.0 License | |
| [FFmpeg](https://github.com/FFmpeg/FFmpeg) | LGPL/GPL | ì„œë¸Œí”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰í•˜ë¯€ë¡œ ì•„ë¬´ ìƒê´€ ì—†ìŒ |
| [Opentofu](https://github.com/opentofu/opentofu) | MPL 2.0 License | HCLë¬¸ë²• ì‚¬ìš© & Opentofu ì‹¤í–‰ì—ëŠ” ì•„ë¬´ ìƒê´€ì—†ìŒ |


## ğŸ“œ ê¸°íƒ€ ë¬¸ì„œ

- [APIëª…ì„¸ì„œ](docs/backup-api.md)